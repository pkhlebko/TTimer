{"version":3,"sources":["main.js"],"names":["trialTimer","getTime","Date","TTimer","settings","timeLimit","gateLimit","startTime","pauseStart","mainTimer","timerFunc","limit","pauseCounter","gatesCounter","finish","type","finalTime","withPenalty","onTimeUpdate","Math","round","onFinish","nextSection","counter","sectionLimit","sections","onNextSection","updateTime","setTimeout","this","strt","onStart","add30","onPenalty","add120","pause","onPauseResume","clearTimeout","onLoad","tTimer","sndStart","sndFinish","sndLimit","sndSection","btnStartFinish","document","getElementById","btnPause","btnNextSector","btnAdd30","btnAdd120","btnSettings","txtLog","lblSectionTime","lblSpentTime","lblTimeLimit","lstTimeLimit","lstSectionLimit","lstSections","pnlSettings","pnlTime","log","text","d","time","getHours","getMinutes","getSeconds","newLi","createElement","innerHTML","insertBefore","children","playSound","sndPath","Audio","play","setControlsDisabled","value","init","disabled","style","display","removeEventListener","addEventListener","spentTime","remainsTime","remainsSectionTime","remainsOnTrack","remainsInSection","min","toFixed","firstChild","removeChild","clearLog","sectionNubmer","finishText","penalty","timerSettings","parseInt","execCommand","window","getSelection","removeAllRanges","selection","empty"],"mappings":"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","file":"main.js","sourcesContent":["var trialTimer = {};\r\n\r\ntrialTimer.TTimer = function(settings) { \r\n  var timeLimit = settings.timeLimit,\r\n    limit = settings.timeLimit,\r\n    gateLimit, \r\n    startTime,\r\n    pauseStart,\r\n    pauseCounter = 0,\r\n    gatesCounter = 0,\r\n    mainTimer,\r\n    timerFunc;\r\n\r\n  this.strt = function() {\r\n    startTime = getTime();\r\n    timerFunc = updateTime;\r\n\r\n    settings.onStart();\r\n    nextSection(0);\r\n    timerFunc();\r\n  };\r\n\r\n  this.nextSection = function() {\r\n    nextSection(getTime() - startTime);\r\n  };\r\n\r\n  this.add30 = function() {\r\n    limit -= 30;\r\n    gateLimit -= 30;\r\n    settings.onPenalty(30);\r\n  };\r\n\r\n  this.add120 = function() {\r\n    limit -= 120;\r\n    settings.onPenalty(120);\r\n  };\r\n\r\n  this.pause = function() {\r\n    if (pauseStart) {\r\n      pauseCounter += getTime() - pauseStart;\r\n      pauseStart = null;\r\n      timerFunc = updateTime;\r\n      timerFunc();\r\n      settings.onPauseResume();\r\n    } else {\r\n      clearTimeout(mainTimer);\r\n      timerFunc = function() {};\r\n      pauseStart = getTime();\r\n      settings.onPauseResume(true);\r\n    }\r\n  };\r\n\r\n  this.finish = finish;\r\n  \r\n  function finish(type) {\r\n    var finalTime = getTime() - startTime - pauseCounter,\r\n        withPenalty = finalTime + settings.timeLimit - limit;\r\n    \r\n    type = type || 'finish';\r\n\r\n    timerFunc = function() {};\r\n    settings.onTimeUpdate(Math.round(finalTime), limit);\r\n    settings.onFinish(finalTime, withPenalty, type);\r\n  }\r\n\r\n  function nextSection(counter) {\r\n    gateLimit = counter + settings.sectionLimit;\r\n    gatesCounter++;\r\n    \r\n    if (gatesCounter > settings.sections) {\r\n      finish('auto');\r\n    } else {\r\n      settings.onNextSection(gatesCounter);\r\n    }\r\n  }\r\n\r\n  function updateTime() {\r\n    var counter = getTime() - startTime - pauseCounter;\r\n\r\n    if (counter >= gateLimit) {\r\n      nextSection(counter);\r\n    }\r\n\r\n    settings.onTimeUpdate(counter, limit - counter, gateLimit - counter);\r\n\r\n    if (counter < limit) {\r\n      mainTimer = setTimeout(function() {\r\n        timerFunc();\r\n      }, 500);\r\n    } else {\r\n      finish('limit');\r\n    }\r\n  }\r\n\r\n\r\n\r\n  return this;\r\n};\r\n\r\nfunction getTime() {\r\n  var d = new Date();\r\n\r\n  return d.getTime() / 1000;\r\n}\r\n\r\ntrialTimer.onLoad = function() {\r\n  var sndStart = 'sounds/start.mp3',\r\n      sndFinish = 'sounds/finish.mp3',\r\n      sndLimit = 'sounds/limit.mp3',\r\n      sndSection = 'sounds/section.mp3';\r\n\r\n  var btnStartFinish = document.getElementById('btnStartFinish'),\r\n      btnPause = document.getElementById('btnPause'),\r\n      btnNextSector = document.getElementById('btnNextSector'),\r\n      btnAdd30 = document.getElementById('btnAdd30'),\r\n      btnAdd120 = document.getElementById('btnAdd120'),\r\n      btnSettings = document.getElementById('btnSettings'),\r\n      txtLog = document.getElementById('log'),\r\n      lblSectionTime = document.getElementById('lblSectionTime'),\r\n      lblSpentTime = document.getElementById('lblSpentTime'),\r\n      lblTimeLimit = document.getElementById('lblTimeLimit'),\r\n      lstTimeLimit = document.getElementById('lstTimeLimit'),\r\n      lstSectionLimit = document.getElementById('lstSectionLimit'),\r\n      lstSections = document.getElementById('lstSections'),\r\n      pnlSettings = document.getElementById('pnlSettings'),\r\n      pnlTime = document.getElementById('pnlTime');\r\n\r\n  var tTimer;\r\n  \r\n  setControlsDisabled(true, true);\r\n\r\n  function log(text, type) {\r\n    var d = new Date(),\r\n        h = (d.getHours()<10?'0':'') + d.getHours(),\r\n        m = (d.getMinutes()<10?'0':'') + d.getMinutes(),\r\n        s = (d.getSeconds()<10?'0':'') + d.getSeconds();\r\n\r\n    var time = '<span>' + h + ':' + m + ':' + s + '</span>',\r\n        newLi = document.createElement('li');\r\n\r\n    newLi.innerHTML = '<li class=\"' + type + '\"><span class=\"time\">' + time + '</span> ' + text + '</li>';\r\n    txtLog.insertBefore(newLi, txtLog.children[1]);\r\n  }\r\n\r\n  function playSound(sndPath) {\r\n    var sound = new Audio(sndPath);\r\n    sound.play();\r\n  }\r\n\r\n  function setControlsDisabled(value, init) {\r\n    btnPause.disabled = value;\r\n    btnNextSector.disabled = value;\r\n    btnAdd30.disabled = value;\r\n    btnAdd120.disabled = value;\r\n    pnlTime.style.display = value ? 'none' : 'flex';\r\n\r\n    if (!init) {\r\n      if (value) {\r\n        btnPause.removeEventListener('click', tTimer.pause);\r\n        btnNextSector.removeEventListener('click', tTimer.nextSection);\r\n        btnAdd30.removeEventListener('click', tTimer.add30);\r\n        btnAdd120.removeEventListener('click', tTimer.add120);\r\n      } else {\r\n        btnPause.addEventListener('click', tTimer.pause);\r\n        btnNextSector.addEventListener('click', tTimer.nextSection);\r\n        btnAdd30.addEventListener('click', tTimer.add30);\r\n        btnAdd120.addEventListener('click', tTimer.add120);\r\n      }\r\n    }\r\n  }\r\n\r\n  function clearLog() {\r\n    while(txtLog.firstChild) {\r\n      txtLog.removeChild(txtLog.firstChild);\r\n    }\r\n    txtLog.innerHTML = '<li class=\"hidden\"></li>';\r\n  }\r\n\r\n  function btnStartFinishClick() {\r\n    switch(btnStartFinish.value) {\r\n      case 'start':\r\n        var timerSettings = {\r\n          timeLimit: parseInt(lstTimeLimit.value),\r\n          sectionLimit: parseInt(lstSectionLimit.value),\r\n          sections: parseInt(lstSections.value),\r\n          onStart: onStart,\r\n          onTimeUpdate: onTimeUpdate,\r\n          onNextSection: onNextSection,\r\n          onPenalty: onPenalty,\r\n          onFinish: onFinish,\r\n          onPauseResume: onPauseResume\r\n        };\r\n\r\n        tTimer = new trialTimer.TTimer(timerSettings);\r\n        tTimer.strt();\r\n      break;\r\n      case 'finish':\r\n        tTimer.finish();\r\n    }\r\n  }\r\n\r\n  function btnSettingsClick() {\r\n    pnlSettings.style.display = pnlSettings.style.display == 'block' ? 'none' : 'block';\r\n  }\r\n\r\n  function txtLogClick() {\r\n    document.execCommand('SelectAll');\r\n    document.execCommand('Copy');\r\n\r\n    // Clear selection\r\n    if (window.getSelection) {\r\n      window.getSelection().removeAllRanges();\r\n    } else if (document.selection) {\r\n      document.selection.empty();\r\n    }\r\n  }\r\n\r\n  // Callbacks\r\n  \r\n  function onTimeUpdate(spentTime, remainsTime, remainsSectionTime) {\r\n    var remainsOnTrack = remainsTime < 0 ? 0 : remainsTime,\r\n        remainsInSection = remainsSectionTime ? remainsSectionTime : 0;\r\n\r\n    lblSectionTime.innerHTML = Math.min(remainsOnTrack, remainsInSection).toFixed(1);\r\n    lblSpentTime.innerHTML = spentTime.toFixed(0);    \r\n    lblTimeLimit.innerHTML = remainsOnTrack.toFixed(0); \r\n  }\r\n\r\n  function onStart() {\r\n    setControlsDisabled(false);\r\n    clearLog();\r\n    playSound(sndStart);\r\n    log('Start', 'start');\r\n    btnStartFinish.value = 'finish';\r\n    btnStartFinish.innerHTML = 'Finish';\r\n    pnlSettings.style.display = 'none';\r\n  }\r\n\r\n  function onNextSection(sectionNubmer) {\r\n    log('Section #' + sectionNubmer);\r\n    playSound(sndSection);\r\n  }\r\n\r\n  function onFinish(finalTime, withPenalty, type) {\r\n    var finishText;\r\n\r\n    switch(type) {\r\n      case 'auto':\r\n        finishText = 'Auto finish ';\r\n        playSound(sndFinish);\r\n        break;\r\n      case 'limit':\r\n        finishText = 'Time limit exceeded ';\r\n        playSound(sndLimit);\r\n        break;\r\n      default:\r\n        finishText = 'Finish ';\r\n        playSound(sndFinish);\r\n    }\r\n\r\n    log(finishText + finalTime.toFixed(2) + 'sec. With penalty ' + withPenalty.toFixed(2) + 'sec.', type);\r\n\r\n    setControlsDisabled(true);\r\n\r\n    btnStartFinish.value = 'start';\r\n    btnStartFinish.innerHTML = 'Start';\r\n  }\r\n\r\n  function onPenalty(penalty) {\r\n    log('Penalty +' + penalty, 'penalty');\r\n  }\r\n\r\n  function onPauseResume(pause) {\r\n    if (pause) {\r\n      btnPause.innerHTML = 'Resume';\r\n      log('Pause', 'pause');\r\n    } else {\r\n      btnPause.innerHTML = 'Pause';\r\n      log('Resume', 'resume');\r\n    }\r\n  }\r\n\r\n  // Events\r\n\r\n  btnStartFinish.addEventListener('click', btnStartFinishClick);\r\n  btnSettings.addEventListener('click', btnSettingsClick);\r\n  txtLog.addEventListener('click', txtLogClick);\r\n};\r\n\r\ndocument.addEventListener('DOMContentLoaded', trialTimer.onLoad, false);"]}